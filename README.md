## list Child Docs列出子文档

> 当前版本： v0.0.1 从这里开始

> 用于思源笔记创建、更新子文档无序列表的挂件，依靠bugs运行。

- 列出当前文档的下一层级子文档列表；
  
- 列出子文档方式：
  - 在挂件中展示`siyuan://`子文档块超链接（安卓端不支持打开[^3]）；
  - 在挂件下新建无序列表展示`siyuan://`子文档块超链接；
  - 在挂件下新建无序列表展示引用块（创建双链）；

- ~~在几种特定情况下自动刷新子文档列表：~~ **如果有使用同步，请勿启用**
  - 挂件被加载（例如：点击文档树打开所在文档）；
  - 点击所在文档页签[^2]；（仅windows）
  - ~~思源窗口从最小化还原；~~（删除挂件时不稳定，已废弃）


## 缺陷&不稳定说明

> 由于开发者能力所限，挂件还存在以下问题。

- 点击页签自动刷新的方法有点玄学，可能在未来的版本更新中无法使用；
- 直接将子文档列表写入文档中（而不是挂件中）时：
  - 过快地刷新文档可能导致无法删除先前创建的子文档列表；
  - 创建挂件块时有概率导致思源(v2.1.5)运行时错误[^1]；
- 更改设置后需要刷新生效，但刷新的同时会更新子文档列表；
- 每次刷新时，将完全更新列表（即使子文档没有变化，也将全部更新列表内容）；

### 自动刷新可能导致同步覆盖

如果需要<u>多设备同步笔记</u>、<u>挂件所在文档内要写其他内容</u>，**请勿启用自动刷新**。

> 假设：文档docA中加入了listChildDocs挂件，并且在AB设备进行了一次同步。
>
> 在设备A 文档中写入了其他内容xxx，进行了一次同步。B 设备打开时初次同步失败，进入笔记，打开了docA文档。

如果在未同步的情况下打开了docA文档，挂件将自动刷新子文档列表，**此时该文档为最新，将会覆盖云端的笔记内容，A设备的编辑将丢失**。

> 打开文档时，挂件没有显示更新时间说明未启用自动刷新。

## 设置项说明

### 界面

<img src="README.assets/image-20220814221708461.png" alt="image-20220814221708461" style="zoom:50%;" />

1: 刷新按钮，点击将保存当前设置 ，并刷新子文档列表；

2: 子文档列出层级选择，1仅列出直接子文档；

3: 列表写入模式：

   `默认`、`挂件`： 将以`siyuan://`超链接的形式在挂件中展示

   `url`： 在挂件下方创建无序列表展示`siyuan://`超链接；

   `引用块`：在挂件下方创建无序列表展示引用块；

4:自动刷新选项【慎用】

   勾选则启用自动刷新（手动刷新后生效）；默认不显示，需要参考下方进行修改。

### 自定义说明

打开`${思源data目录}\widgets\listChildDocs\src\config.js`，设置项说明请参考各配置项旁边的注释。

- 创建挂件时的默认设置项等需要在该文件中修改。

## 反馈bug

请到github仓库新建issue。

## 参考&感谢

### 参考

本挂件参考了以下大佬的项目：

- [InEase](https://github.com/InEase) - [Note Map](https://github.com/InEase/SiYuan-Xmind)；


### 依赖

1. jQuery （本项目中通过jQuery选择页面元素）；

```
 * jQuery JavaScript Library v3.6.0
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
```



[^1]: 目前已通过延迟插入块规避，延迟时间为1秒。运行时错误为：`not found previous block`。
[^2]: 不稳定，此功能通过监视页签变化获取当前文档更新时间。默认仅在windows启用。
[^3]: 安卓端(v2.1.5)点击挂件内`<a>`思源块超链接导致app闪退。