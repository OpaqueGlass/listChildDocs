## list Child Docs列出子文档

> 当前版本： v0.0.9 **新增**：挂件中或文档中，支持以有序列表的形式创建目录（需更改模式），支持多级序号的目录创建（以全角空格缩进）；**改进&修复**：`默认`模式逻辑（间接修复浏览器、iOS`默认`模式无法点击的问题）；**改进**：`挂件beta`模式浮窗触发方式跟随思源设置（是否需要ctril+悬停触发）；**改进**：放宽限制，在`默认``挂件`模式下，插入挂件后允许自动刷新；
> 
> 插入时模式为`默认`、启用自动刷新、层级1、分栏1、大纲层级3；如要修改插入时默认设置，请参考自定义说明部分。
>

> 用于思源笔记创建、更新子文档目录列表的挂件，依靠bugs运行。

- 创建当前文档的子文档目录列表；
  - 创建当前文档大纲列表；

- 子文档目录列表形式（在`模式`中选择）：
  - 挂件中或文档中创建目录；
  - 有序列表或无序列表；
  - （文档中）`siyuan://`URL或引用块；
  
- 在几种特定情况下自动刷新子文档目录列表（安全模式下不刷新文档中的目录）：
  - 挂件被加载（例如：点击文档树打开所在文档）[^1]；
  - 点击所在文档页签[^2]；（仅windows）

## 设置项说明

### 界面

![图片](README.assets/setting.png)

![图片](/widgets/listChildDocs/README.assets/setting.png)

1. 刷新按钮：单击将刷新子文档列表 ；双击将保存当前设置 ；

2. 显示/隐藏设置

> 以下设置项变更后，需要**双击刷新按钮保存设置**，否则下次启动时将丢失更改。

3. 自动刷新选项：勾选则启用自动刷新。 

4. 子文档目录列表深度/层级选择：（控制是否展示子文档的子文档，展示几层）

   设置为1仅列出直接子文档，设置为0列出当前文档大纲，请输入数字；（过多的层级将导致性能下降）

5. 目录列表分栏数（分列数）控制：为1单列，请输入数字；（过多的分栏可能排版效果不佳）

   > 当屏幕宽度过窄时（<=768px），挂件中分栏设定将会被忽略，只允许显示1列；

6. 列表写入模式：

   模式名称前有`1.`的，将以有序列表的方式创建目录；模式名称前有`1.1.`的，将在有序列表的基础上使用全角空格缩进，创建多级编号的目录；

   1. 无序列表\*

      - `默认`： （挂件中创建目录）“引用块”（无浮窗）；

      - `挂件beta`：（挂件中创建目录）“引用块”（悬停时触发浮窗，不稳定）；

      - `url`： （文档中创建目录）在挂件下方创建无序列表展示`siyuan://`超链接；

      - `引用块`：（文档中创建目录）在挂件下方创建无序列表展示引用块；

   2. 有序列表\*

      - `1.默认`：（挂件中）有序列表“引用块”（无浮窗）；

      - `1.挂件`：（挂件中）有序列表展示“引用块”（悬停时触发浮窗，不稳定）；

      - ……


7. 大纲层级：列出大纲时，设定大纲的显示层级数；

> 需要现将子文档目录层级设置为0并双击刷新按钮保存设置后，才会显示大纲层级设定（层级数为实际层级，与h1h2无关）。
>
> 如果在自定义设置中，选择列出终端文档的大纲，此项只控制大纲的显示层级。

\*注：文档中分栏使用超级块实现。

### 自定义说明

打开`${思源data目录}\widgets\listChildDocs\src\config.js`，设置项说明请参考各配置项旁边的注释。举例：在此文档可以修改：

【常用】

- 创建（插入）挂件时的默认参数（分列数、层级数、模式、是否自动刷新）`custom_attr`（如果写入文档，不要将auto的默认值设定为true）；

- 一并生成叶子文档的大纲目录：`showEndDocOutline`；默认禁用

  （刷新慢，挂件中生成目录时体验极差）

- 安全模式`safeMode`：默认启用。

  启用后，挂件将不对文档中的目录进行自动刷新，防止同步过程中自动刷新导致同步冲突/覆盖；（如果使用同步，建议启用安全模式[^4]）；

- 挂件中展示目录时，根据目录长度自动更改挂件高度： `autoHeight`；默认禁用；

  （启用后，不用在挂件中上下滑动了），如果在移动端、挂件中列出目录，建议开启；

- 显示（写入）文档图标`emojiEnable`；默认启用；

- 写入自定义emoji图片：`customEmojiEnable`；默认启用【暂不支持网络emoji图片】；

【不常用】

- 超级块分列（分栏）时在缩进位置折断：`divideColumnAtIndent`；

- 新的超级块构成方式beta：`superBlockBeta`；

- 刷新列表后重写属性`inheritAttrs`；

- 刷新后属性写入列表对应HTML元素的属性类型`includeAttrName`；

- 点击页签刷新生效系统`includeOs`；

  默认仅用于windows，不适用于ios和Android。其他平台未测试，如要使用，请手动更改；

- ....其他设置；

### 使用举例

有些主题支持将文档中的无序列表显示为导图/表格。理论上v0.0.5+版本可以在刷新后保留相关属性设定，即刷新后仍然展示为导图/表格。

注：如果视图更改为导图/表格，请不要使用分列，请将分列数设置为1。

> 在此前的版本，刷新目录列表后将丢失自定义属性，现在相关属性将在刷新后重写，并将`custom-f`属性写入对应元素。

## ⚠️注意

> 由于开发者能力所限，挂件还存在以下问题。

- 直接将子文档目录列表**写入文档中**时：
  - 请避免过快地刷新文档列表；
  - 如果要<u>多设备同步文档</u>、且<u>挂件所在文档要写其他内容</u>时，**请勿使用自动刷新**[^4]；
- 每次刷新时，将完全更新列表（即使子文档没有变化，也将更新列表全部内容）；
- 双击刷新按钮会保存设置（设定挂件属性），文档编辑时间将被更新，**如果当时未完成同步，请勿双击刷新按钮**[^4]；
- 点击页签自动刷新的方法有点玄学，可能在未来的版本更新中无法使用；
- 关于超级块属性刷新后重写：
  - `superBlockBeta`应设为`true`；
  - 若刷新后为超级块，属性将写入超级块的所有无序列表子块；
  - 若刷新前为超级块，将随机选择一个无序列表子块的属性进行重写；
  - 如要删除属性，建议直接删除超级块；
- 关于写入自定义emoji图片：
  - 挂件以图片的方式写入的自定义emoji，有一些边距导致对齐效果不好；
  - 请避免图片路径包括特殊符号，例如`()%& `，如果包括，不能确定实际效果;
  - 自定义emoji不在assets下，不是资源文件，会有网络图片角标（设置-编辑器-是否显示网络图片角标）；
  - 不建议使用网络Emoji；



## 反馈bug

请到github仓库[新建issue](https://github.com/OpaqueGlass/listChildDocs/issues/new/choose)。

## 参考&感谢

本挂件使用/参考了以下大佬的项目：

| 开发者                                      | 项目                                                     | 开源协议                                                     | 备注                 |
| ------------------------------------------- | -------------------------------------------------------- | ------------------------------------------------------------ | -------------------- |
| [leolee9086](https://github.com/leolee9086) | [cc-template](https://github.com/leolee9086/cc-template) | [木兰宽松许可证， 第2版](https://github.com/leolee9086/cc-template/blob/main/LICENSE) | 在挂件中展示“引用块“ |
| [InEase](https://github.com/InEase)         | [Note Map](https://github.com/InEase/SiYuan-Xmind)       | N/A                                                          | API使用方式          |

以下大佬参与代码贡献：

| 开发者                                            | PR                                                           |
| ------------------------------------------------- | ------------------------------------------------------------ |
| [Zuoqiu-Yingyi](https://github.com/Zuoqiu-Yingyi) | [文档深度下拉框改为输入框PR#1](https://github.com/OpaqueGlass/listChildDocs/pull/1) |



### 依赖

1. jQuery （本项目中通过jQuery选择页面元素）；

```
jQuery JavaScript Library v3.6.0  https://jquery.com/
Copyright OpenJS Foundation and other contributors
Released under the MIT license  https://jquery.org/license
```

### 图标

1. [刷新按钮图标](https://www.iconfinder.com/icons/5402417/refresh_rotate_sync_update_reload_repeat_icon)，作者：[amoghdesign](https://www.iconfinder.com/amoghdesign)，许可协议：[CC3.0 BY-NC](http://creativecommons.org/licenses/by-nc/3.0/)；

2. [设置按钮图标](https://www.iconfinder.com/icons/5925600/control_options_settings_icon)，作者：[IconPai](https://www.iconfinder.com/iconpai)，许可说明：Free for commercial use (Include link to authors website)；



[^1]: 例外：安全模式下，写入文档时（在文档中创建目录），将不会自动刷新。
[^2]: 通过监视页签变化获取当前文档是否更新，默认仅在windows启用，不支持ios、android系统。例外：安全模式下，写入文档时，将不会自动刷新。
[^4]: 当挂件更新文档内的目录列表（或保存设置）后，当前设备文档编辑时间将更新。如果当前设备未同步，则新文档会覆盖云端内容，导致其他设备的编辑丢失。目前，在写入挂件时（在挂件中创建目录），自动刷新不更改文档内容，理论上不会影响文档编辑时间。
